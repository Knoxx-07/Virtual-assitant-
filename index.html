<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KNOXX - Virtual Assistant</title>
  <link rel="shortcut icon" href="avatar.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;200;300;400;500;600;700&display=swap");
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Roboto Mono", monospace; }
    .main { min-height:100vh; width:100%; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .main .image-container { padding:10px; }
    .main .image-container .image { width:100%; display:flex; align-items:center; justify-content:center; }
    .main .image-container .image img { width:350px; }
    .main .image-container h1 { color:#00bcd4; text-align:center; margin-bottom:10px; font-size:40px; }
    .main .image-container p { color:#324042; text-align:center; margin-bottom:40px; }
    .main .input { display:flex; justify-content:center; align-items:center; width:40vw; height:50px; border-radius:20px; background:rgba(202,253,255,0.5); }
    .main .input .talk { background:transparent; border:none; outline:none; width:50px; height:50px; display:flex; justify-content:center; align-items:center; font-size:15px; cursor:pointer; }
    .main .input .talk i { font-size:20px; color:#aed0d0; }
    .main .input .content { color:#aed0d0; font-size:15px; margin-right:20px; }
    .chat-window { width:80%; max-width:600px; height:250px; background:#111; color:#aed0d0; padding:10px; margin:10px auto; overflow-y:auto; border-radius:10px; font-size:14px; }
    .chat-window .message { margin:5px 0; padding:6px 10px; border-radius:6px; }
    .chat-window .message.kknoxx { background: rgba(0, 188, 212, 0.2); align-self:flex-start; }
    .chat-window .message.user { background: rgba(174,208,208,0.3); align-self:flex-end; }
    .quick-actions { display:flex; justify-content:center; gap:10px; margin-top:10px; }
    .quick-actions button { background:#00bcd4; color:#000; border:none; padding:8px 15px; border-radius:20px; cursor:pointer; transition:0.2s; }
    .quick-actions button:hover { background:#00a0b0; color:#fff; }
  </style>
</head>
<body>
  <section class="main">
    <div class="image-container">
      <div class="image"><img src="giphy.gif" alt="image"></div>
      <h1>K N O X X</h1>
      <p>I am your Virtual Assistant. How may I help you?</p>
    </div>

    <div class="chat-window">
      <div class="message kknoxx">Initializing KNOXX...</div>
    </div>

    <div class="input">
      <button class="talk"><i class="fas fa-microphone-alt"></i></button>
      <h1 class="content">Click here to speak</h1>
    </div>

    <div class="quick-actions">
      <button onclick="takeCommand('tell me a joke')">Joke</button>
      <button onclick="takeCommand('what is the weather in Delhi')">Weather</button>
      <button onclick="takeCommand('translate hello to French')">Translate</button>
    </div>
  </section>

  <script>
    const btn = document.querySelector('.talk');
    const chatWindow = document.querySelector('.chat-window');
    let greeted = false;
    let messages = [];
    let voices = [];

    window.speechSynthesis.onvoiceschanged = () => { voices = window.speechSynthesis.getVoices(); }

    const jokes = [
      "Why don't scientists trust atoms? Because they make up everything!",
      "Why did the computer go to the doctor? It caught a virus!",
      "Why was the math book sad? Because it had too many problems!",
      "Why did the scarecrow win an award? Because he was outstanding in his field!"
    ];

    function addMessage(message, sender){
      const div = document.createElement('div');
      div.classList.add('message', sender);
      div.textContent = message;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function speak(text, voiceName="Google UK English Male") {
      const utter = new SpeechSynthesisUtterance(text);
      const selectedVoice = voices.find(v => v.name === voiceName);
      if (selectedVoice) utter.voice = selectedVoice;
      utter.rate=1; utter.pitch=1; utter.volume=1;
      window.speechSynthesis.speak(utter);
      addMessage(text,'kknoxx');
    }

    function speakAssistant(text){ speak(text, "Google UK English Male"); }
    function speakJoke(text){ speak(text, "Google US English"); }

    function wishMe(){
      if(!greeted){
        const hour = new Date().getHours();
        if(hour<12) speakAssistant("Good Morning Boss...");
        else if(hour<17) speakAssistant("Good Afternoon Master...");
        else speakAssistant("Good Evening Sir...");
        greeted=true;
      }
    }

    window.addEventListener('load', ()=>{ speakAssistant("Initializing KNOXX..."); wishMe(); });

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.interimResults=false;
    recognition.onstart=()=> btn.classList.add('listening');
    recognition.onend=()=> btn.classList.remove('listening');
    recognition.onresult=(event)=>{
      const transcript=event.results[0][0].transcript;
      addMessage(transcript,'user');
      takeCommand(transcript.toLowerCase());
    }
    btn.addEventListener('click', ()=> { document.querySelector('.content').textContent="Listening..."; recognition.start(); });

    async function askChatGPT(message){
      try{
        messages.push({role:"user", content: message});
        document.querySelector('.content').textContent="Thinking...";
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method:"POST",
          headers:{"Content-Type":"application/json", "Authorization":"Bearer YOUR_OPENAI_API_KEY"},
          body: JSON.stringify({ model:"gpt-3.5-turbo", messages:messages, max_tokens:200 })
        });
        const data = await response.json();
        const reply = data.choices[0].message.content.trim();
        messages.push({role:"assistant", content: reply});
        speakAssistant(reply);
      } catch(err){ speakAssistant("Cannot reach ChatGPT right now."); console.error(err); }
    }

    function takeCommand(message){
      recognition.stop();

      if(message.includes('hey') || message.includes('hello')) speakAssistant("Hello Sir, How May I Help You?");
      else if(message.includes("open google")) window.open("https://google.com","_blank"), speakAssistant("Opening Google");
      else if(message.includes("open youtube")) window.open("https://youtube.com","_blank"), speakAssistant("Opening Youtube");
      else if(message.includes("open facebook")) window.open("https://facebook.com","_blank"), speakAssistant("Opening Facebook");
      else if(message.includes('time')) speakAssistant("Current time is "+new Date().toLocaleTimeString());
      else if(message.includes('date')) speakAssistant("Today's date is "+new Date().toLocaleDateString());
      else if(message.includes('joke')) speakJoke(jokes[Math.floor(Math.random()*jokes.length)]);
      else if(message.includes('weather')){
        const cityMatch = message.match(/weather in (.*)/);
        const city = cityMatch ? cityMatch[1] : 'Delhi';
        fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=YOUR_WEATHER_API_KEY&units=metric`)
          .then(res=>res.json())
          .then(data=>{ if(data.main) speakAssistant(`Weather in ${city} is ${data.weather[0].description} and ${data.main.temp}Â°C`); else speakAssistant("Cannot fetch weather"); })
          .catch(()=>speakAssistant("Error fetching weather"));
      }
      else if(message.includes('calculator')) window.open('Calculator:///'), speakAssistant("Opening Calculator");
      else if(message.includes('notepad')) window.open('notepad:///'), speakAssistant("Opening Notepad");
      else askChatGPT(message);
    }
  </script>
</body>
</html>
